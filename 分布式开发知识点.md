# 什么是CAP原则

CAP原则又称CAP定理，指的是在一个分布式系统中，一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance）。CAP 原则指的是，这三个要素最多只能同时实现两点，不可能三者兼顾。

分区容错性：指一个系统中的一个或者多个节点宕机，但是只要还有能正常工作的节点，就要保证系统对外是可以正常提供服务的。这是分布式系统最基本的需求，所以分区容错性是必须的，所以一般是在CP和AP中做选择。

一致性：一旦数据更新完成，分布式系统所有节点在同一时间要保证数据完全一致。如果要保证数据强一致性，就需要在开始写入时对节点资源进行锁定，待数据同步完成后才会释放，这就会造成写的过程中会阻塞其他请求。

可用性：读和写操作在任何时候都要成功。

为什么CAP不能三者兼顾，以数据库主从读写分离为例，如果要保证一致性，就要在数据写入时对主从都加锁，这期间不能读写直到数据更新完成；如果要保证可用性，那么主写入数据时从可能正在被读取数据，主从未同步的时候可能就会造成数据不一致。

# SpringCloud核心组件及其作用

- Eureka：服务注册中心，负责服务的注册、发现和治理。每个服务都向Eureka登记自己的元数据(包括IP、端口、版本号、通信协议等)，eureka将服务信息维护在一个双层Map中(Map的第一层key是服务名，第二层key是服务的实例id，value是实例信息)，同时使用心跳机制来维护服务的通信，剔除不可用服务。Eureka集群中每个节点都有相同的服务实例信息。同时服务之间相互调用的时候，服务自己不需要知道要调用的服务的IP、端口等信息，只需要通过服务名向Eureka获取要调用的服务对应的信息。

- Ribbon：负载均衡组件。服务间相互调用的时候，基于Ribbon做负载均衡，从服务的列表里挑出一个来做调用。Ribbon是客户端负载均衡，也就是调用法需要自己维护服务信息并根据负载算法从其中挑选一个服务调用。

- Hystrix：服务熔断降级。

  - 服务熔断：当服务A调用服务B的时候，发现服务B不可用，这个时候服务A不会继续调用服务B，而是直接返回结果，直到服务B可用为止。当调用失败次数打到阈值的时候就打开熔断器，熔断器打开后就不会再去调用服务而是直接返回结果，过了一段时间后，熔断器进入半打开状态，此时部分请求会被熔断器放过去真正的调用服务，如果这些调用都成功了，那么就把熔断器关闭，否则熔断器重新进入打开状态。
  - 服务降级：当发现系统压力过大的时候，可以通过关闭某个服务或者限流某个服务来减轻系统压力，这就是服务降级。

  服务熔断与服务降级的区别：熔断是下游服务故障触发的，降级是为了降低系统负载主动触发的。

- Feign：http客户端，已经集成了Ribbon和Hystrix，包装了http调用的过程，实现了接口调用。

- Config/Apollo：统一配置中心，代替配置文件，实现灵活配置。

- Gateway：网关，可以用于路由转发、鉴权、限流。

# 什么是服务降级、熔断



